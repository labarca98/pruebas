<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="implementation-test-suite.xml" />
	<munit:test name="implementation-test-suite-delete-sobjects-inTest" doc:id="361a26fc-fa02-42d9-ba6a-11a7e49faa08" description="Test">
		<munit:behavior >
			<munit-tools:spy doc:name="salesforce:query" doc:id="914a47a8-f34e-4e34-a3f1-3a6fc0aa37d0" processor="salesforce:query">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="All objects of selected type" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="ea080087-14aa-450a-88b8-35d7e3402b03" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:before-call >
					<munit-tools:assert-that doc:name="vars.externalIdIn is as expected" doc:id="6ef5aa51-b5c2-449f-9628-00b16ea71410" message="vars.externalIdIn is not as expected" expression="#[vars.externalIdIn]" is="#[MunitTools::equalTo(['123','456'])]"/>
				</munit-tools:before-call>
			</munit-tools:spy>
			<munit-tools:mock-when doc:name="salesforce:query" doc:id="8132712c-7b04-49dd-86cc-a8c941114ad0" processor="salesforce:query">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="All objects of selected type" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="ea080087-14aa-450a-88b8-35d7e3402b03" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/java --- [{
  "Id": "abc",
  "ExternalId__c": "123"
},{
  "Id": "efg",
  "ExternalId__c": "456"
}]]' mediaType="application/java" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:spy doc:name="salesforce:create-job" doc:id="e8563d27-c871-4506-a03b-196274d2951d" processor="salesforce:create-job">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Delete sObjects deleted from Merlin" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="9694d137-7cee-431e-86f5-b672cbf84986" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:before-call >
					<munit-tools:assert-that doc:name="Payload is as expected" doc:id="677898f2-2dcb-4506-a7c2-c82575a6dc18" is='#[MunitTools::equalTo([{
  "Id": "abc"
},{
  "Id": "efg"
}])]' expression="#[payload]"/>
				</munit-tools:before-call>
			</munit-tools:spy>
			<munit-tools:mock-when doc:name="salesforce:create-job delete" doc:id="c7f5d15f-b4ef-4d38-840b-5027f04e8c9a" processor="salesforce:create-job">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Delete sObjects deleted from Merlin" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="9694d137-7cee-431e-86f5-b672cbf84986" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/java
---
{
  "id": "xyz"
}]' mediaType="application/java" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="flow-ref finalize-bulk-api-job" doc:id="4544d756-5af6-4e03-8d28-10c815db78db" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="finalize-bulk-api-v1-job" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="67962513-62fb-4a1f-8fcb-92112569afde" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/json
---
{
  "id": "xyz"
}]' mediaType="application/json" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Set Event" doc:id="442aade1-f47f-41a5-a09c-967f744936dd" >
				<munit:payload value='#[output application/csv --- [{
  "ExternalId__c": "123"
},{
  "ExternalId__c": "456"
}]]' encoding="UTF-8" mediaType="application/csv" />
				<munit:variables >
					<munit:variable key="sObjectsType" value="InexistantSalesforceObjectForTest__c" />
				</munit:variables>
			</munit:set-event>
			<flow-ref doc:name="Flow-ref to delete-sobjects" doc:id="3fc51f8a-d370-40ac-8f29-1dd208c81250" name="delete-sobjects"/>
		</munit:execution>
	</munit:test>
	<munit:test name="implementation-test-suite-delete-sobjects-not-inTest" doc:id="7aee97e5-b160-4e18-a7cf-4675e7d458e4" description="Test">
		<munit:behavior >
			<munit-tools:spy doc:name="salesforce:query" doc:id="a58609a6-84b2-4c5a-8751-93bfe76ceb63" processor="salesforce:query">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="All objects of selected type" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="5b52ab55-6050-4fa7-b043-11f2ca5b8456" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:before-call >
					<munit-tools:assert-that doc:name="vars.externalIdNotIn is as expected" doc:id="a30cf2f2-47d4-4381-b90e-2abb684a9fc7" message="vars.externalIdNotIn is not as expected" expression="#[vars.externalIdNotIn]" is="#[MunitTools::equalTo(['123','456'])]"/>
				</munit-tools:before-call>
			</munit-tools:spy>
			<munit-tools:mock-when doc:name="salesforce:query" doc:id="526f4747-1d99-4c40-84ec-e9258c87e925" processor="salesforce:query">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="All objects of selected type" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="5b52ab55-6050-4fa7-b043-11f2ca5b8456" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/java --- [{
  "Id": "abc",
  "ExternalId__c": "123"
},{
  "Id": "efg",
  "ExternalId__c": "456"
},{
  "Id": "hij",
  "ExternalId__c": "789"
}]]' mediaType="application/java" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:spy doc:name="salesforce:create-job" doc:id="762d0968-10e8-48bd-b5be-38aae37a9f66" processor="salesforce:create-job">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Delete sObjects deleted from Merlin" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="75d27b1e-aa6b-4629-928d-debbe01a68fa" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:before-call >
					<munit-tools:assert-that doc:name="Payload is as expected" doc:id="756f8ead-2072-41ba-b0e0-5bc15d2dc61b" is='#[MunitTools::equalTo([{
  "Id": "hij"
}])]' expression="#[payload]"/>
				</munit-tools:before-call>
			</munit-tools:spy>
			<munit-tools:mock-when doc:name="salesforce:create-job delete" doc:id="161a9f6e-ed6a-48ab-9522-5aa99620f42f" processor="salesforce:create-job">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Delete sObjects deleted from Merlin" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="75d27b1e-aa6b-4629-928d-debbe01a68fa" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/java
---
{
  "id": "xyz"
}]' mediaType="application/java" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="flow-ref finalize-bulk-api-job" doc:id="cbabf5b6-8c6d-4428-9a02-ef7e33ccd6f9" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="finalize-bulk-api-v1-job" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="ff77f9cb-5ecc-4326-a5b2-a9e7accbe011" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[output application/json
---
{
  "id": "xyz"
}]' mediaType="application/json" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Set Event" doc:id="92e13ddc-4688-40e1-83a8-c00e9b72479c" >
				<munit:payload value='#[output application/csv --- [{
  "ExternalId__cNotIn": "123"
},{
  "ExternalId__cNotIn": "456"
}]]' encoding="UTF-8" mediaType="application/csv" />
				<munit:variables >
					<munit:variable key="sObjectsType" value="InexistantSalesforceObjectForTest__c" />
				</munit:variables>
			</munit:set-event>
			<flow-ref doc:name="Flow-ref to delete-sobjects" doc:id="c9ae897e-6fec-4460-9091-37b4ecb69d29" name="delete-sobjects"/>
		</munit:execution>
	</munit:test>

</mule>
